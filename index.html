<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>SENSE - Sensory Exploration</title>
  <link rel="stylesheet" href="style.css?v=4">
</head>
<body>
  <!-- Particle canvas (background layer for all scenes) -->
  <canvas id="particle-canvas"></canvas>

  <!-- Welcome Screen -->
  <div id="screen-welcome" class="screen active">
    <div class="welcome-content">
      <div class="welcome-character">
        <div class="cat-welcome">
          <div class="cat-ear cat-ear-l"></div>
          <div class="cat-ear cat-ear-r"></div>
          <div class="cat-face">
            <div class="cat-eye cat-eye-l"><div class="cat-pupil"></div></div>
            <div class="cat-eye cat-eye-r"><div class="cat-pupil"></div></div>
            <div class="cat-nose"></div>
            <div class="cat-mouth"></div>
          </div>
          <div class="cat-body-welcome"></div>
          <div class="cat-tail"></div>
        </div>
      </div>
      <h1>Let's Explore!</h1>
      <p class="welcome-subtitle">Help the kitten find what feels just right</p>
      <button id="btn-start" class="btn-primary bounce-hover">
        Start
      </button>
      <button id="btn-skip" class="btn-secondary" style="margin-top:0.8rem; font-size:0.85rem;">
        Skip to Video (Demo)
      </button>
    </div>
  </div>

  <!-- Scene 1: Auditory -->
  <div id="screen-auditory" class="screen">
    <div class="scene-header">
      <div class="scene-progress">
        <div class="progress-fill" style="width:12.5%"></div>
      </div>
      <div class="scene-title">Listen to the music box</div>
    </div>
    <div class="scene-container" id="container-auditory">
      <div class="scene-bg auditory-bg">
        <div class="floating-notes" id="floating-notes"></div>
        <div class="sound-source" id="sound-source">
          <div class="music-box-body">
            <div class="music-box-lid"></div>
            <div class="music-box-base"></div>
            <div class="music-box-crank"></div>
          </div>
          <div class="sound-rings" id="sound-rings">
            <div class="ring r1"></div>
            <div class="ring r2"></div>
            <div class="ring r3"></div>
          </div>
        </div>
        <div class="avatar draggable" id="avatar-auditory" data-scene="auditory">
          <div class="cat-avatar">
            <div class="cat-a-ear cat-a-ear-l"></div>
            <div class="cat-a-ear cat-a-ear-r"></div>
            <div class="cat-a-face">
              <div class="cat-a-eye cat-a-eye-l"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-eye cat-a-eye-r"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-mouth"></div>
            </div>
          </div>
          <svg class="hold-ring-svg" id="hold-ring-auditory" viewBox="0 0 120 120">
            <circle class="ring-bg" cx="60" cy="60" r="55"/>
            <circle class="ring-fill" cx="60" cy="60" r="55"/>
          </svg>
        </div>
      </div>
    </div>
    <div class="scene-hint" id="hint-auditory">
      <span class="hand-pointer">ğŸ‘†</span> Drag the kitten closer or farther from the music
    </div>
  </div>

  <!-- Scene 2: Visual -->
  <div id="screen-visual" class="screen">
    <div class="scene-header">
      <div class="scene-progress">
        <div class="progress-fill" style="width:37.5%"></div>
      </div>
      <div class="scene-title">Find the right brightness</div>
    </div>
    <div class="scene-container" id="container-visual">
      <div class="scene-bg visual-bg" id="visual-bg">
        <div class="garden-bg">
          <div class="bg-flower bf1">ğŸŒ±</div>
          <div class="bg-flower bf2">ğŸŒ±</div>
          <div class="bg-flower bf3">ğŸŒ±</div>
          <div class="bg-flower bf4">ğŸŒ±</div>
          <div class="bg-flower bf5">ğŸŒ±</div>
          <div class="bg-flower bf6">ğŸŒ±</div>
        </div>
        <div class="visual-target" id="visual-target">
          <div class="big-flower">
            <div class="big-flower-glow"></div>
            <div class="big-flower-icon">ğŸŒ¸</div>
          </div>
        </div>
        <div class="avatar draggable" id="avatar-visual" data-scene="visual">
          <div class="cat-avatar">
            <div class="cat-a-ear cat-a-ear-l"></div>
            <div class="cat-a-ear cat-a-ear-r"></div>
            <div class="cat-a-face">
              <div class="cat-a-eye cat-a-eye-l"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-eye cat-a-eye-r"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-mouth"></div>
            </div>
          </div>
          <svg class="hold-ring-svg" id="hold-ring-visual" viewBox="0 0 120 120">
            <circle class="ring-bg" cx="60" cy="60" r="55"/>
            <circle class="ring-fill" cx="60" cy="60" r="55"/>
          </svg>
        </div>
      </div>
    </div>
    <div class="scene-hint" id="hint-visual">
      <span class="hand-pointer">ğŸ‘†</span> Drag the kitten to find comfortable colors
    </div>
  </div>

  <!-- Scene 3: Spatial -->
  <div id="screen-spatial" class="screen">
    <div class="scene-header">
      <div class="scene-progress">
        <div class="progress-fill" style="width:62.5%"></div>
      </div>
      <div class="scene-title">Meet a new friend</div>
    </div>
    <div class="scene-container" id="container-spatial">
      <div class="scene-bg spatial-bg">
        <div class="park-bg">
          <div class="grass"></div>
          <div class="cloud c1">â˜ï¸</div>
          <div class="cloud c2">â˜ï¸</div>
        </div>
        <div class="npc-character" id="npc-character">
          <div class="dog-avatar">
            <div class="dog-ear dog-ear-l"></div>
            <div class="dog-ear dog-ear-r"></div>
            <div class="dog-face">
              <div class="dog-eye dog-eye-l"><div class="dog-pupil"></div></div>
              <div class="dog-eye dog-eye-r"><div class="dog-pupil"></div></div>
              <div class="dog-nose"></div>
              <div class="dog-tongue hidden"></div>
            </div>
            <div class="dog-tail"></div>
          </div>
          <div class="npc-reaction" id="npc-reaction"></div>
          <div class="heart-particles" id="heart-particles"></div>
        </div>
        <div class="avatar draggable" id="avatar-spatial" data-scene="spatial">
          <div class="cat-avatar">
            <div class="cat-a-ear cat-a-ear-l"></div>
            <div class="cat-a-ear cat-a-ear-r"></div>
            <div class="cat-a-face">
              <div class="cat-a-eye cat-a-eye-l"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-eye cat-a-eye-r"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-mouth"></div>
            </div>
          </div>
          <svg class="hold-ring-svg" id="hold-ring-spatial" viewBox="0 0 120 120">
            <circle class="ring-bg" cx="60" cy="60" r="55"/>
            <circle class="ring-fill" cx="60" cy="60" r="55"/>
          </svg>
        </div>
      </div>
    </div>
    <div class="scene-hint" id="hint-spatial">
      <span class="hand-pointer">ğŸ‘†</span> Drag the kitten to say hello to the puppy
    </div>
  </div>

  <!-- Scene 4: Temporal -->
  <div id="screen-temporal" class="screen">
    <div class="scene-header">
      <div class="scene-progress">
        <div class="progress-fill" style="width:87.5%"></div>
      </div>
      <div class="scene-title">Watch the magic light</div>
    </div>
    <div class="scene-container" id="container-temporal">
      <div class="scene-bg temporal-bg">
        <div class="starfield" id="starfield"></div>
        <div class="temporal-target" id="temporal-target">
          <div class="magic-bell">
            <div class="bell-body">ğŸ””</div>
            <div class="bell-glow"></div>
          </div>
        </div>
        <!-- The traveling light orb -->
        <div class="light-orb" id="light-orb"></div>
        <div class="avatar draggable" id="avatar-temporal" data-scene="temporal">
          <div class="cat-avatar">
            <div class="cat-a-ear cat-a-ear-l"></div>
            <div class="cat-a-ear cat-a-ear-r"></div>
            <div class="cat-a-face">
              <div class="cat-a-eye cat-a-eye-l"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-eye cat-a-eye-r"><div class="cat-a-pupil"></div></div>
              <div class="cat-a-mouth"></div>
            </div>
          </div>
          <svg class="hold-ring-svg" id="hold-ring-temporal" viewBox="0 0 120 120">
            <circle class="ring-bg" cx="60" cy="60" r="55"/>
            <circle class="ring-fill" cx="60" cy="60" r="55"/>
          </svg>
        </div>
      </div>
    </div>
    <div class="scene-hint" id="hint-temporal">
      <span class="hand-pointer">ğŸ‘†</span> Drag the kitten â€” watch the magic light fly!
    </div>
  </div>

  <!-- Celebration overlay -->
  <div id="celebration" class="celebration hidden">
    <canvas id="confetti-canvas"></canvas>
    <div class="celebration-emoji">ğŸ‰</div>
  </div>

  <!-- Results Screen -->
  <div id="screen-results" class="screen">
    <div class="results-content">
      <div class="results-icon">â­</div>
      <h1>All Done!</h1>
      <p class="results-subtitle">Here's what the kitten likes</p>
      <div class="results-grid" id="results-grid"></div>
      <div class="results-data hidden" id="results-data"></div>
      <button id="btn-watch-video" class="btn-primary bounce-hover">
        Watch Your Video
      </button>
      <button id="btn-restart" class="btn-secondary">
        Play Again
      </button>
      <button id="btn-export" class="btn-secondary">
        Export Data
      </button>
    </div>
  </div>

  <!-- Stage 2: Processing Transition -->
  <div id="screen-processing" class="screen">
    <div class="processing-content">
      <div class="processing-icon">ğŸ¬</div>
      <h1>Creating Your Video</h1>
      <div class="processing-steps" id="processing-steps">
        <div class="processing-step" id="step-spatial">
          <span class="step-dot active"></span>
          <span>Selecting scene based on comfort level...</span>
        </div>
        <div class="processing-step" id="step-audio">
          <span class="step-dot"></span>
          <span>Adjusting sounds...</span>
        </div>
        <div class="processing-step" id="step-visual">
          <span class="step-dot"></span>
          <span>Setting brightness...</span>
        </div>
        <div class="processing-step" id="step-ready">
          <span class="step-dot"></span>
          <span>Ready!</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Stage 2: Video Playback -->
  <div id="screen-video" class="screen">
    <div class="video-fullscreen">
      <video id="sense-video" playsinline preload="auto">
        <source src="video/base_medium.mp4" type="video/mp4">
      </video>
      <!-- YouTube-style bottom control bar -->
      <div class="video-controls" id="video-controls">
        <!-- Progress bar (full width, top of bar) -->
        <div class="vc-progress-wrap" id="timeline-track">
          <div class="vc-progress-bg"></div>
          <div class="vc-progress-fill" id="timeline-progress"></div>
          <div class="vc-progress-thumb" id="timeline-thumb"></div>
          <!-- Segment markers -->
          <div class="vc-marker" style="left:22%"></div>
          <div class="vc-marker" style="left:42%"></div>
          <div class="vc-marker" style="left:61%"></div>
          <div class="vc-marker" style="left:81%"></div>
        </div>
        <!-- Controls row -->
        <div class="vc-row">
          <div class="vc-left">
            <button class="vc-btn" id="vc-play-pause">â–¶</button>
            <span class="vc-time" id="timeline-time">0:00 / 0:00</span>
          </div>
          <div class="vc-right">
            <!-- FAB trigger integrated into bar -->
            <button class="vc-btn vc-btn-sm" id="fab-dot">âš™</button>
          </div>
        </div>
      </div>

      <!-- YouTube-style center play/pause overlay -->
      <div class="video-play-overlay" id="video-play-overlay">
        <div class="play-overlay-icon" id="play-overlay-icon">â–¶</div>
      </div>

      <!-- Settings panel (anchored to âš™ in control bar) -->
      <div class="fab-control" id="fab-control">
        <div class="fab-panel hidden" id="fab-panel">
          <div class="fab-section">
            <div class="fab-level-label">Level</div>
            <div class="fab-levels">
              <button class="fab-level" data-level="1" title="Gentle â€” more filtered">ğŸ›¡</button>
              <button class="fab-level active" data-level="2" title="Baseline â€” child's own">â—</button>
              <button class="fab-level" data-level="3" title="Challenge â€” closer to real">ğŸ¯</button>
            </div>
          </div>
          <div class="fab-divider"></div>
          <div class="fab-section">
            <button class="fab-btn fab-btn-sm" id="fab-profile-toggle">â“˜ Profile</button>
          </div>
          <!-- Sensory profile (hidden by default) -->
          <div class="fab-profile hidden" id="fab-profile">
            <div class="profile-row">
              <span class="profile-icon">ğŸ”Š</span>
              <div class="profile-bar"><div class="profile-bar-fill" id="bar-auditory"></div></div>
              <span class="profile-label" id="label-auditory">â€”</span>
            </div>
            <div class="profile-row">
              <span class="profile-icon">ğŸ”†</span>
              <div class="profile-bar"><div class="profile-bar-fill" id="bar-visual"></div></div>
              <span class="profile-label" id="label-visual">â€”</span>
            </div>
            <div class="profile-row">
              <span class="profile-icon">ğŸ‘¤</span>
              <div class="profile-bar"><div class="profile-bar-fill" id="bar-spatial"></div></div>
              <span class="profile-label" id="label-spatial">â€”</span>
            </div>
            <div class="profile-row">
              <span class="profile-icon">â±</span>
              <div class="profile-bar"><div class="profile-bar-fill" id="bar-temporal"></div></div>
              <span class="profile-label" id="label-temporal">â€”</span>
            </div>
          </div>
        </div>
      </div>

      <!-- S2 pause overlay -->
      <div class="s2-pause-overlay hidden" id="s2-pause-overlay">
        <div class="s2-pause-card">
          <p class="s2-pause-title">How is your child feeling?</p>
          <p class="s2-pause-subtitle">Choose a level for the rest of the video</p>
          <div class="s2-level-options">
            <button class="s2-level-btn" data-level="1">
              <span class="s2-level-icon">ğŸ›¡</span>
              <span class="s2-level-name">Gentle</span>
              <span class="s2-level-desc">More filtered</span>
            </button>
            <button class="s2-level-btn selected" data-level="2">
              <span class="s2-level-icon">â—</span>
              <span class="s2-level-name">Child's Own</span>
              <span class="s2-level-desc">Baseline</span>
            </button>
            <button class="s2-level-btn" data-level="3">
              <span class="s2-level-icon">ğŸ¯</span>
              <span class="s2-level-name">Challenge</span>
              <span class="s2-level-desc">Closer to real</span>
            </button>
          </div>
          <button class="s2-continue-btn" id="s2-continue">Continue â–¶</button>
        </div>
      </div>

      <!-- Temporal freeze frame overlay -->
      <div class="freeze-overlay hidden" id="freeze-overlay">
        <div class="freeze-indicator">
          <div class="freeze-icon">â¸</div>
          <div class="freeze-label">Preparing...</div>
          <div class="freeze-countdown">0.0s</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hold confirmation overlay -->
  <div id="hold-overlay" class="hold-overlay hidden">
    <div class="hold-text">Stay still... ğŸ¾</div>
    <div class="hold-progress-bar">
      <div class="hold-progress-fill" id="hold-progress-fill"></div>
    </div>
  </div>

  <script src="app.js?v=4"></script>
</body>
</html>
